# Бот для поздравления менторов

Этот скрипт предназначен для отправки поздравления менторам, бот определяет являетесь вы ментором или нет, после чего предлогает поздравить ментора или завершить работу. Бот позволяет выбрать определённого ментора из списка и открытку с поздравлением.

## Оглавление

- [Требования](#требования)
- [Установка](#установка)
    - [Переменные окружения](#переменные-окружения)
- [Структура проекта](#структура-проекта)
    - [Папка `data`](#папка-data)
    - [Папка `libs`](#папка-libs)
    - [Файлы в корневом каталоге](#файлы-в-корневом-каталоге)
    - [Как работает проект](#как-работает-проект)
- [Использование](#использование)
- [Запуск тестов](#запуск-тестов)
- [Цель проекта](#цель-проекта)


## Требования

- Python 3.12.6
- `httpx` library
- `pydantic` library
- `python-telegram-bot` library
- `urllib3` library


## Установка

- Скачайте код
- Установите зависимости командой `pip install -r requirements.txt`


### Переменные окружения

Создайте файл `.env` в корне проекта и добавьте в него токен телеграмм бота.  \
`TG_BOT_TOKEN=your_telegram_bot_token` # Получить его можно здесь [BotFather](https://telegram.me/BotFather).


## Структура проекта

### Папка `data`
Содержит тестовые данные:

 - `mentors.json` — список менторов.

- `congratulations.json` — коллекция открыток с поздравлениями.

- `ascii_art.json` — коллекция ASCII-артов (в разработке).

Эти данные предоставляются тестовым сервером (`test_server.py`) по соответствующим запросам.

### Папка `libs`
Содержит скрипт для выполнения запросов к серверу. Этот скрипт используется для взаимодействия с API сервера и получения данных.

### Файлы в корневом каталоге
- `main.py`\
    Содержит функции для получения данных:
    - `fetch_mentors()` — возвращает список менторов.
    - `fetch_congratulations()` — возвращает открытки с поздравлениями.

- `validators.py`\
    Содержит модели Pydantic для валидации данных:
    - `Mentor` — модель данных ментора.
    - `MentorsResponse` — модель ответа с списком менторов.
    - `Congratulations` — модель коллекции поздравлений.
    - `AsciiArt` — модель коллекции ASCII-артов. (в разработке)

- `bot.py`\
    Основной файл, содержащий всю логику работы Telegram-бота:
    - Обработка команд и callback-запросов.
    - Взаимодействие с сервером для получения данных.
    - Отображение менторов и поздравлений.
    - Обработка ошибок и уведомление пользователей.

### Как работает проект
1. **Сервер**  (`test_server.py`)\
Предоставляет API для получения данных:
    - `/mentors` — возвращает список менторов.
    - `/congratulations` — возвращает коллекцию поздравлений.
    - `/asciiart` — возвращает коллекцию ASCII-артов.

2. **Бот** (`bot.py`)\
Взаимодействует с сервером через функции из `main.py`, используя модели валидации из `validators.py`. Бот предоставляет пользователю интерфейс для выбора ментора и поздравления.

3. **Валидация данных**\
Все данные, полученные от сервера, проверяются с помощью моделей Pydantic, что гарантирует их корректность и соответствие ожидаемой структуре.


## Использование

Для запуска тестового сервера выполните команду:
```bash
python test_server.py
```
После запуска сервер будет доступен по адресу http://127.0.0.1:8000. Вы можете отправлять запросы к следующим эндпоинтам:
- `/mentors` — получить список менторов.
- `/congratulations` — получить коллекцию открыток с поздравлениями.
- `/asciiart` — получить коллекцию ASCII-артов (в разработке).

Для запуска бота выполните команду:
```bash
python bot.py
```
После запуска бота:
1. Напишите команду /start в чате с ботом.
2. Бот отправит приветственное сообщение и определит, являетесь ли вы ментором.
3. Выберите ментора из списка.
4. Выберите подходящее поздравление.
5. Бот покажет выбранного ментора и поздравление, а также предложит отправить поздравление.
6. После подтверждения вы получите сообщение об успешной отправке поздравления.

## Запуск тестов

Для запуска тестов, необходимо сначала запустить тестовый сервер, для этого выполните следующую команду из корневой папки проекта:

```bash
python tests/test_server.py
```

Чтобы запустить тесты, используйтся библиотека pytest. В корневом каталоге проекта выполните следующую команду:

```bash
pytest test.py
```

## Цель проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).


